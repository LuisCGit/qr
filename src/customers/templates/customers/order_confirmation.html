{% extends 'customers/base.html'%}
{% load i18n %}


{% block content %}
<style>
  .bg-custom-1 {
    background-color: rgb(108, 183, 60);
  }
</style>


  <!-- Feedback success Message -->
  {% if messages %}
    {% for message in messages %}
      {% if message.level == DEFAULT_MESSAGE_LEVELS.INFO %}
      <div class="row justify-content-center alert alert-primary pt-3 pb-3" role="alert">
          <!-- <div class="col-md-8"> -->
            <h5>{{ message }}</h5>
          <!-- </div> -->
      </div>
      {% endif %}
    {% endfor %}
  {% endif %}

  <!-- End Message -->
<div class="container-fluid">
  <div class="card text-center text-white p-3 bg-custom-1 mt-5 mb-3">
    <div class="card-body">
      <svg class="bi bi-check-circle-fill" width="2em" height="2em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
      </svg>
      {% if cart.cash_payment %}
        <h5 class="card-title pt-3">{% trans "Order Number:" %} <b>{{ cart.id }}</b></h5>
        <h7 class="pt-3">{% trans "Please pay when you pick up your order." %}
      {% else %}
        <h5 class="card-title pt-3">{% trans "Payment Confirmed" %}</h5>
        <p>{% trans "Order Number:" %} <b>{{ cart.id }}</b></p>
      {% endif %}

      {% if cart.email %}
      <p class="pt-3">{% trans "Email Receipt:" %} {{ cart.email }}</p>
      {% endif %}
    </div>
  </div>

  <div id="receipt">
    <div class="card shadow p-3 bg-white rounded mb-4">
      <div class="card-body">
        <div class="row">
          <div class="col-2">
            <svg class="bi bi-receipt" width="2em" height="1.5em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27zm.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0l-.509-.51z"/>
              <path fill-rule="evenodd" d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"/>
            </svg>
          </div>
          <div class="col-10">
            <h5 class="cart-title pb-1">{% trans "Order Details" %}</h5>
          </div>
        </div>
          {% for item in items %}
          <div class="row mt-3">
            <div class="col-2">
              {{ item.quantity }}
            </div>
            <div class="col-6">
              <h5>{{ item.item.name }}</h5>
            </div>
            <div class="col-4">
              <h6>${{ item.price }}</h6>
            </div>
          </div>

          <!-- addon items -->
          {% if item.addon_items %}
          {% for addon in item.addon_items.all %}
          <div class="row mb-1">
            <div class="col-8">
              + {{ addon.name }}
            </div>
            <div class="col-4">
              ${{ addon.price }}
            </div>
          </div>
          {% endfor %}
          {% endif %}
          <!-- end addon items -->

          {% if item.custom_instructions %}
          <div class="row mb-2">
            <div class="col-2 d-flex flex-row-reverse">
              <p>.</p>
            </div>
            <div class="col-10">
              <p>{{ item.custom_instructions }}</p>
            </div>
          </div>
          {% endif %}
          <hr>
          {% endfor %}

          <div class="row pt-3">
            <div class="col-6">
              <h6>{% trans "Subtotal" %}</h6>
            </div>
            <div class="col-6 d-flex flex-row-reverse">
              ${{ cart.total }}
            </div>
          </div>

          <div class="row pt-1">
            <div class="col-6">
              <h6>{% trans "Tip" %}</h6>
            </div>
            {% if cart.tip %}
            <div class="col-6 d-flex flex-row-reverse">
              ${{ cart.tip }}
            </div>
            {% else %}
            <div class="col-6 d-flex flex-row-reverse">
              $0.00
            </div>
            {% endif %}
          </div>
          <div class="row pt-1">
            <div class="col-6">
              <h5>{% trans "Total" %}</h5>
            </div>
            {% if cart.total_with_tip %}
            <div class="col-6 d-flex flex-row-reverse">
              ${{ cart.total_with_tip }}
            </div>
            {% else %}
            <div class="col-6 d-flex flex-row-reverse">
              ${{ cart.total }}
            </div>
            {% endif %}
          </div>
      </div>
    </div>
  </div>


  <!-- Feedback Form -->
  <div class="card shadow p-3 bg-white rounded mb-4">
    <div class="card-body">
      <div class="row">
          <h5 class="cart-title pb-1">{% trans "Feedback" %}</h5>
      </div>
      <form method = 'post' action = '/customers/feedback/{{ cart.id }}'>
        {% csrf_token %}

        <div class = 'row justify-content-center'>
          {% trans "Feedback about this app?" as feedback_placeholder %}
          <input class="form-control" type="text" id="feedback" name="feedback" placeholder="{{feedback_placeholder}}">
        </div>

        <!-- Buttons -->
        <div class="row justify-content-center mt-3 mb-3">
            <div class="btn-group">
                <button type="submit" class="btn btn-secondary">{% trans "Submit" %}</button>
            </div>
        </div>

      </form>
    </div>
  </div>


  <footer class="page-footer pt-4">
      <div class="row justify-content-center mb-3">
          <a href="/customers" class="btn btn-dark btn-lg active w-75 shadow" role="button" aria-pressed="true">{% trans "Back to Menu" %}</a>
      </div>
  </footer>
</div>

<script>
  $(document).ready(function(){
    var cart_id = {{ cart.id }};
    var receipt_html = $("#receipt").html();

    $.ajax({
      type: "POST",
      url: "{% url 'ajax_receipt' %}",
      data: {
        'cart_id': cart_id,
        'receipt_html': receipt_html,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      dataType: 'json',
      success: function (data) {
        console.log('successfuly sent receipt_html from customer')

      }
    });
  });

</script>
{% endblock %}
